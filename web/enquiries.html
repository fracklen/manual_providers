<!DOCTYPE html>
<html lang="dk">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Udbydere - visning og kontakt info kliks</title>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"></script>
    <script src="http://sofa.lokalebasen.dk:5984/public/js/Chart.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="container-fluid">
      <h1>Enquiries</h1>
    </div>
    <script type="text/javascript">


      var DATABASE = "";
      var data = [];
      function setWeeks() {
        url = DATABASE + "/enquiries_pr_week/_all_docs?include_docs=true"
        $.get(url, function( rsp_data ) {
          rows = JSON.parse(rsp_data).rows
          setChart(rows);
          var chart = new CanvasJS.Chart("chartContainer",
          {
            zoomEnabled: true,
            legend:{
              verticalAlign: "center",
              horizontalAlign: "right"
            },
            toolTip:{
              shared:true
            },
            title:{
              text: "Enqueries pr uge"
            },
            axisX :{
              labelAngle: -30
            },
            axisY :{
              includeZero:false
            },
            data: data
          });

          chart.render();
        });
      }

      window.onload = function () {
        url = DATABASE + "/enquiries_pr_week/_all_docs?include_docs=true"
        $.get(url, function( data ) {
          rows = JSON.parse(data).rows
          setChart(rows)
        });
      }

      setWeeks();

      function setChart(weeks) {

        var y = 0;
        var normalDataSeries = { type: "line",showInLegend: true, name: "Normal" };
        // var totalDataSeries = { type: "line",showInLegend: true, name: "Total" };
        var normalDataPoints = [];
        // var totalDataPoints = [];

        for(i=0;i<weeks.length;i++){
          week = weeks[i].doc
          label = week._id
          // vip.push(week.vip);
          // extra.push(week.extra);

          normalDataPoints.push({
            label: label,
            x: i,
            y: week.normal
          });

          // totalDataPoints.push({
          //   label: label,
          //   x: i,
          //   y: week.total
          // });
        }

        normalDataSeries.dataPoints = normalDataPoints;
        // totalDataSeries.dataPoints = totalDataPoints;
        data.push(normalDataSeries);
        // data.push(totalDataSeries);
      }

    </script>

    <script src="http://sofa.lokalebasen.dk:5984/public/js/canvasjs.min.js"></script>
    <div id="chartContainer" style="height: 400px; width: 100%;"></div>


  </body>
</html>
